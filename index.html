<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Assistant</title>

    <!-- Google Fonts: Montserrat for English, Noto Sans Bengali for Bengali -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Noto+Sans+Bengali:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <!-- Libraries for Markdown, LaTeX, and Code Highlighting -->
    <script
      src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"
      defer
    ></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
      integrity="sha384-n8MVd4RsNIU0KOVEMutoExTqlSFyL5NqN4dHRnPse9WBUSzvsA5longdGhwcskNA"
      crossorigin="anonymous"
    />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
      integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
      crossorigin="anonymous"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
      integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"
      defer
    ></script>

    <style>
      :root {
        --bg-color: #121212;
        --surface-color: #1e1e1e;
        --primary-color: #bb86fc;
        --primary-variant-color: #3700b3;
        --secondary-color: #03dac6;
        --text-color: #e0e0e0;
        --text-secondary-color: #a0a0a0;
        --border-color: #333;
        --error-color: #cf6679;
        --font-english: "Montserrat", sans-serif;
        --font-bengali: "Noto Sans Bengali", sans-serif;
      }

      /* --- Base Styles & Typography Upgrade --- */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html,
      body {
        height: 100%;
        background-color: var(--bg-color);
        color: var(--text-color);
        font-size: 16px;
        overflow: hidden;
        font-family: var(--font-english), var(--font-bengali);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        line-height: 1.6;
      }

      /* --- LAYOUT (Mobile First) --- */
      #app-container {
        width: 100vw;
        position: relative;
        height: 100vh;
        height: 100dvh;
      }

      #sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 998;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
      }
      #sidebar-overlay.open {
        opacity: 1;
        visibility: visible;
      }
      #sidebar {
        background-color: var(--surface-color);
        border-right: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
        width: 280px;
        max-width: 85vw;
        height: 100%;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 999;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
      }
      #sidebar.open {
        transform: translateX(0);
      }
      #chat-container {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        position: relative;
      }

      /* --- DESKTOP LAYOUT OVERRIDE --- */
      @media (min-width: 769px) {
        #app-container {
          display: flex;
          height: 100vh;
        }
        #sidebar {
          position: static;
          transform: translateX(0);
          flex-shrink: 0;
          max-width: 280px;
        }
        #menu-toggle,
        #sidebar-overlay {
          display: none;
        }
        #sidebar.open {
          transform: translateX(0);
        }
        #sidebar-overlay.open {
          opacity: 0;
          visibility: hidden;
        }
        #chat-container {
          flex-grow: 1;
          width: auto;
        }
      }

      /* --- Sidebar Components --- */
      .sidebar-header {
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        flex-shrink: 0;
      }
      #new-chat-btn {
        width: 100%;
        padding: 0.75rem;
        background-color: var(--primary-color);
        color: var(--bg-color);
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: background-color 0.2s;
        font-family: var(--font-english);
      }
      #new-chat-btn:hover {
        background-color: var(--secondary-color);
      }
      #history-list {
        flex-grow: 1;
        overflow-y: auto;
        padding: 0.5rem 0;
      }
      .history-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem 1rem;
        cursor: pointer;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        border-left: 3px solid transparent;
      }
      .history-item:hover {
        background-color: rgba(255, 255, 255, 0.05);
      }
      .history-item.active {
        background-color: rgba(255, 255, 255, 0.1);
        border-left-color: var(--primary-color);
      }
      .delete-chat-btn {
        background: none;
        border: none;
        color: var(--text-secondary-color);
        cursor: pointer;
        font-size: 1rem;
        padding: 0.25rem;
        opacity: 0;
        transition: opacity 0.2s;
      }
      .history-item:hover .delete-chat-btn {
        opacity: 1;
      }
      .sidebar-footer {
        padding: 1rem;
        border-top: 1px solid var(--border-color);
        flex-shrink: 0;
        display: flex;
        flex-direction: column;
        gap: 0.75rem; /* Space between buttons */
      }
      .sidebar-footer-btn {
        width: 100%;
        padding: 0.75rem;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        background-color: var(--surface-color);
        border: 1px solid var(--primary-color);
        color: var(--primary-color);
        transition: background-color 0.2s, color 0.2s;
        font-family: var(--font-english);
      }
      .sidebar-footer-btn.active {
        background-color: var(--primary-color);
        color: var(--bg-color);
      }

      /* --- Main Chat Components --- */
      .chat-header {
        padding: 0.75rem 1rem;
        background-color: var(--surface-color);
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: bold;
        flex-shrink: 0;
        font-family: var(--font-english);
      }
      .header-left {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }
      .icon-btn {
        background: none;
        border: none;
        color: var(--text-color);
        cursor: pointer;
        font-size: 1.5rem;
        padding: 0.25rem;
      }
      #chat-messages {
        flex-grow: 1;
        overflow-y: auto;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      .message {
        max-width: 85%;
        padding: 0.75rem 1rem;
        border-radius: 12px;
        white-space: pre-wrap;
        word-wrap: break-word;
        position: relative;
        display: table;
        line-height: 1.6;
      }
      .message:hover .message-actions {
        opacity: 1;
      }
      .message.user {
        background-color: var(--primary-variant-color);
        align-self: flex-end;
        border-bottom-right-radius: 2px;
      }
      .message.model {
        background-color: var(--surface-color);
        align-self: flex-start;
        border-bottom-left-radius: 2px;
      }
      .message.error {
        background-color: var(--error-color);
        color: white;
        align-self: center;
      }
      .message.loading {
        color: var(--text-secondary-color);
        align-self: flex-start;
      }
      .message-actions {
        position: absolute;
        bottom: -5px;
        right: 5px;
        display: flex;
        gap: 4px;
        background: var(--surface-color);
        padding: 2px 4px;
        border-radius: 6px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        opacity: 0;
        transition: opacity 0.2s;
      }
      .action-btn {
        background: none;
        border: none;
        color: var(--text-secondary-color);
        cursor: pointer;
        font-size: 0.9rem;
      }

      /* --- Content Styling (Shared by Chat and Notes) --- */
      .rendered-content-area {
          --code-bg: #282c34;
      }
      .rendered-content-area p {
        margin-bottom: 0.75em;
      }
      .rendered-content-area p:last-child {
        margin-bottom: 0;
      }
      .rendered-content-area ul,
      .rendered-content-area ol {
        padding-left: 1.5em;
        margin-bottom: 0.75em;
      }
      .rendered-content-area h3 {
          margin-top: 1.5em;
          margin-bottom: 0.5em;
          padding-bottom: 0.3em;
          border-bottom: 1px solid var(--border-color);
          color: var(--secondary-color);
      }
      .rendered-content-area strong {
          color: var(--primary-color);
      }
      .rendered-content-area pre {
        background-color: var(--code-bg);
        color: #abb2bf;
        padding: 1em;
        border-radius: 8px;
        margin: 0.5em 0;
        font-family: "Courier New", Courier, monospace;
        white-space: pre-wrap;
        overflow-wrap: break-word;
      }
      .rendered-content-area code {
        font-family: "Courier New", Courier, monospace;
        background-color: var(--code-bg);
        padding: 0.2em 0.4em;
        border-radius: 4px;
      }
      .rendered-content-area pre code {
        padding: 0;
        background: none;
      }
      .rendered-content-area blockquote {
        border-left: 3px solid var(--primary-color);
        padding-left: 1em;
        margin: 0.5em 0;
        color: var(--text-secondary-color);
      }
      .katex {
        font-size: 1.1em;
        letter-spacing: 0.05em;
      }
      .katex svg {
        max-width: 100%;
      }
      .katex-display {
        overflow-x: auto;
        overflow-y: hidden;
        padding: 0.5em 0.4em;
        margin: 0.2em 0;
        line-height: 1.2;
        scrollbar-width: thin;
        scrollbar-color: var(--primary-color) var(--surface-color);
      }
      .katex-display::-webkit-scrollbar {
        height: 6px;
      }
      .katex-display::-webkit-scrollbar-track {
        background: var(--surface-color);
      }
      .katex-display::-webkit-scrollbar-thumb {
        background-color: var(--primary-color);
        border-radius: 6px;
      }
      
      /* --- NEW: Markdown Notes Viewer --- */
      #markdown-viewer {
          flex-grow: 1;
          overflow-y: auto;
          padding: 1.5rem;
          display: none; /* Hidden by default */
      }


      /* --- Input Area --- */
      #chat-form-container {
        padding: 1rem;
        border-top: 1px solid var(--border-color);
        background-color: var(--bg-color);
        flex-shrink: 0;
      }
      #file-previews {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
        overflow-x: auto;
        padding-bottom: 0.5rem;
      }
      .preview-item {
        position: relative;
        width: 70px;
        height: 70px;
        flex-shrink: 0;
      }
      .preview-item img,
      .preview-item video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
      }
      .preview-item .remove-file {
        position: absolute;
        top: -5px;
        right: -5px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        border: none;
        cursor: pointer;
        font-size: 14px;
      }
      .loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 8px;
      }
      .spinner {
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        width: 25px;
        height: 25px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      #input-area {
        display: flex;
        align-items: flex-end;
        background-color: var(--surface-color);
        border-radius: 12px;
        padding: 0.5rem;
      }
      #chat-input {
        flex-grow: 1;
        border: none;
        background: transparent;
        color: var(--text-color);
        font-size: 1rem;
        resize: none;
        max-height: 120px;
        overflow-y: auto;
        font-family: var(--font-english), var(--font-bengali);
      }
      #chat-input:focus {
        outline: none;
      }
      .input-btn {
        background: none;
        border: none;
        color: var(--text-secondary-color);
        cursor: pointer;
        font-size: 1.5rem;
        padding: 0.5rem;
        border-radius: 8px;
        transition: background-color 0.2s;
      }
      .input-btn:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }
      #send-btn {
        color: var(--primary-color);
      }

      /* --- Custom Modal --- */
      #custom-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 1rem;
      }
      #custom-modal-overlay.open {
        opacity: 1;
        visibility: visible;
      }
      #custom-modal {
        background-color: var(--surface-color);
        padding: 1.5rem;
        border-radius: 12px;
        border: 1px solid var(--border-color);
        width: 100%;
        max-width: 400px;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        transform: scale(0.9);
        transition: transform 0.3s ease;
      }
      #custom-modal-overlay.open #custom-modal {
        transform: scale(1);
      }
      #modal-message {
        margin-bottom: 1.5rem;
        line-height: 1.6;
      }
      #modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 0.75rem;
      }
      .modal-btn {
        padding: 0.6rem 1.2rem;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: background-color 0.2s;
        font-family: var(--font-english);
      }
      #modal-cancel-btn {
        background-color: transparent;
        border: 1px solid var(--border-color);
        color: var(--text-color);
      }
      #modal-cancel-btn:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }
      #modal-confirm-btn {
        background-color: var(--primary-color);
        color: var(--bg-color);
      }
      #modal-confirm-btn:hover {
        background-color: var(--secondary-color);
      }
      #modal-confirm-btn.danger {
        background-color: var(--error-color);
        color: white;
      }
      #modal-confirm-btn.danger:hover {
        background-color: #e57c8d;
      }

      /* --- MOBILE RESPONSIVE TWEAKS --- */
      @media (max-width: 768px) {
        .message {
          max-width: 95%;
        }
        #chat-messages,
        #chat-form-container,
        #markdown-viewer {
          padding-left: 0.5rem;
          padding-right: 0.5rem;
        }
        .chat-header {
          padding-left: 0.5rem;
          padding-right: 0.5rem;
        }
        .header-left span {
          display: none;
        }
        .input-btn {
          padding: 0.4rem;
          font-size: 1.25rem;
        }
      }
      @media (max-width: 480px) {
        html,
        body {
          font-size: 15px;
        }
        #chat-input {
          font-size: 0.95rem;
        }
      }
    </style>
  </head>
  <body>
    <div id="app-container">
      <aside id="sidebar">
        <div class="sidebar-header">
          <button id="new-chat-btn">＋ New Chat</button>
        </div>
        <div id="history-list"></div>
        <div class="sidebar-footer">
          <!-- NEW BUTTON ADDED HERE -->
          <button id="view-notes-btn" class="sidebar-footer-btn">Concept Notes</button>
          <button id="tutor-mode-btn" class="sidebar-footer-btn">AI Tutor Mode</button>
        </div>
      </aside>
      <main id="chat-container">
        <div id="sidebar-overlay"></div>
        <div class="chat-header">
          <div class="header-left">
            <button id="menu-toggle" class="icon-btn" title="Toggle Menu">
              ☰
            </button>
            <span>AI Assistant</span>
          </div>
        </div>
        <!-- NEW MARKDOWN VIEWER AND EXISTING CHAT MESSAGES -->
        <div id="markdown-viewer" class="rendered-content-area"></div>
        <div id="chat-messages"></div>
        <div id="chat-form-container">
          <div id="file-previews"></div>
          <form id="chat-form" novalidate>
            <div id="input-area">
              <input
                type="file"
                id="file-input"
                multiple
                accept="image/*,video/*"
                hidden
              />
              <button
                type="button"
                id="gallery-btn"
                class="input-btn"
                title="Upload from Gallery"
              >
                🖼️
              </button>
              <button
                type="button"
                id="camera-btn"
                class="input-btn"
                title="Take a Photo"
              >
                📷
              </button>
              <textarea
                id="chat-input"
                placeholder="Message Assistant..."
                rows="1"
              ></textarea>
              <button
                type="submit"
                id="send-btn"
                class="input-btn"
                title="Send"
              >
                ➤
              </button>
            </div>
          </form>
        </div>
      </main>
    </div>
    <div id="custom-modal-overlay">
      <div id="custom-modal">
        <p id="modal-message">Are you sure?</p>
        <div id="modal-actions">
          <button id="modal-cancel-btn" class="modal-btn">Cancel</button>
          <button id="modal-confirm-btn" class="modal-btn">Confirm</button>
        </div>
      </div>
    </div>

    <script>
      // --- START OF JAVASCRIPT ---
      const API_URL = "/api/generate";

      // --- NEW: CONTENT FOR THE NOTES VIEWER ---
            // --- NEW: CONTENT FOR THE NOTES VIEWER ---
      const conceptNotesMarkdown = `### **অধ্যায়: চল তড়িৎ (Current Electricity)**

এই অধ্যায়ের কনসেপ্টগুলো এমনভাবে সাজানো হয়েছে যেন একজন শিক্ষার্থী শূন্য থেকে শুরু করেও প্রতিটি বিষয় সহজে বুঝতে পারে এবং গাণিতিক সমস্যা সমাধানে পারদর্শী হতে পারে।

---

### **Type 01: তুল্য রোধ (Equivalent Resistance)**

**Concept:**
বর্তনীতে একাধিক রোধের পরিবর্তে যে একটি মাত্র রোধ ব্যবহার করলে বর্তনীর মোট প্রবাহ এবং বিভব পার্থক্য অপরিবর্তিত থাকে, তাকে ঐ বর্তনীর তুল্য রোধ বলে। রোধের সমবায় মূলত দুই প্রকার:

*   **শ্রেণি বা সিরিজ সমবায় (Series Combination):** যখন রোধগুলো একটার পর একটা এমনভাবে যুক্ত থাকে যেন প্রথমটির শেষ প্রান্তের সাথে দ্বিতীয়টির প্রথম প্রান্ত, দ্বিতীয়টির শেষ প্রান্তের সাথে তৃতীয়টির প্রথম প্রান্ত যুক্ত থাকে।
    *   **মূল বৈশিষ্ট্য:** প্রতিটি রোধের মধ্যে দিয়ে **একই পরিমাণ তড়িৎ (I) প্রবাহিত** হয়, কিন্তু তাদের দুই প্রান্তের **বিভব পার্থক্য (V) ভিন্ন** হয়।
*   **সমান্তরাল সমবায় (Parallel Combination):** যখন রোধগুলোর এক প্রান্ত একটি সাধারণ বিন্দুতে এবং অপর প্রান্ত অন্য একটি সাধারণ বিন্দুতে যুক্ত থাকে।
    *   **মূল বৈশিষ্ট্য:** প্রতিটি রোধের দুই প্রান্তের **বিভব পার্থক্য (V) একই** থাকে, কিন্তু তাদের মধ্যে দিয়ে প্রবাহিত **তড়িৎ (I) ভিন্ন** হয়।

**Formula:**
*   শ্রেণি সমবায়ের তুল্য রোধ: \`Rs = R₁ + R₂ + R₃ + ... + Rₙ\`
*   সমান্তরাল সমবায়ের তুল্য রোধ: \`1/Rp = 1/R₁ + 1/R₂ + 1/R₃ + ... + 1/Rₙ\`

**Common Mistakes & Tips:**

*   **ভুল:** সমান্তরাল সমবায়ের ক্ষেত্রে \`1/Rp\`-এর মান বের করার পর প্রায়ই শিক্ষার্থীরা উত্তর উল্টে \`Rp\`-এর মান বের করতে ভুলে যায়।
*   **টিপস:** দুইটি রোধ \`R₁\` ও \`R₂\` সমান্তরালে থাকলে তুল্য রোধ সরাসরি \`Rp = (R₁ × R₂) / (R₁ + R₂) \` সূত্র দিয়ে বের করলে সময় বাঁচবে।
*   **ট্রিকস:** বর্তনী দেখে সিরিজ নাকি সমান্তরাল বুঝতে সমস্যা হলে, ব্যাটারির এক প্রান্ত থেকে তড়িৎ প্রবাহের পথ কল্পনা করুন। যদি প্রবাহ ভাগ না হয়ে একই পথে সব রোধের মধ্যে দিয়ে যায়, তবে তা সিরিজ। আর যদি কোনো বিন্দুতে এসে প্রবাহ একাধিক পথে ভাগ হয়ে গিয়ে আবার অন্য কোনো বিন্দুতে মিলিত হয়, তবে সেই পথগুলো সমান্তরালে আছে।

**Examples (Progressive Difficulty):**

**Example 1:** 3 Ω, 6 Ω এবং 9 Ω মানের তিনটি রোধকে শ্রেণি সমবায়ে যুক্ত করলে তুল্য রোধ কত হবে?
*   **ব্যবহৃত সূত্র:** \`Rs = R₁ + R₂ + R₃\`
*   **Solution:**
    \`Rs = 3 + 6 + 9 = 18 Ω\`

**Example 2:** 4 Ω এবং 12 Ω মানের দুইটি রোধকে সমান্তরালে যুক্ত করা হলো। তুল্য রোধ নির্ণয় কর।
*   **ব্যবহৃত সূত্র:** \`Rp = (R₁ × R₂) / (R₁ + R₂)\`
*   **Solution:**
    \`Rp = (4 × 12) / (4 + 12) = 48 / 16 = 3 Ω\`

**Example 3:** নিচের বর্তনীতে A ও B বিন্দুর মধ্যে তুল্য রোধ নির্ণয় কর।



*   **Solution Strategy:** প্রথমে 6 Ω ও 3 Ω রোধ দুটি সমান্তরালে আছে, তাদের তুল্য রোধ বের করতে হবে। এরপর সেই তুল্য রোধের সাথে 4 Ω রোধটি শ্রেণিতে যুক্ত হবে।
*   **Solution:**
    Step 1: 6 Ω ও 3 Ω এর তুল্য রোধ, \`Rp = (6 × 3) / (6 + 3) = 18 / 9 = 2 Ω\`
    Step 2: এখন 4 Ω এবং \`Rp\` (2 Ω) শ্রেণিতে যুক্ত।
    \`Req = 4 + 2 = 6 Ω\`

---

### **Type 02: কারেন্ট ডিভাইডার এবং ভোল্টেজ ডিভাইডার সূত্র**

**Concept:**
*   **কারেন্ট ডিভাইডার (Current Divider):** সমান্তরাল সমবায়ে যুক্ত একাধিক শাখার মধ্যে কোনো নির্দিষ্ট শাখার প্রবাহ বের করার জন্য এই সূত্র ব্যবহার করা হয়। মূল প্রবাহ যখন একাধিক পথে বিভক্ত হয়, তখন কোন পথে কতটুকু প্রবাহ যাবে তা রোধের মানের উপর নির্ভর করে।
*   **ভোল্টেজ ডিভাইডার (Voltage Divider):** শ্রেণি সমবায়ে যুক্ত একাধিক রোধের কোনো নির্দিষ্ট রোধের দুই প্রান্তের বিভব পার্থক্য বের করার জন্য এই সূত্র ব্যবহার করা হয়। মোট ভোল্টেজ রোধের মান অনুসারে ভাগ হয়ে যায়।

**Formula:**
*   **কারেন্ট ডিভাইডার:** \`Iₓ = I_total × (Rp / Rₓ)\`
    এখানে, \`Iₓ\` হলো \`Rₓ\` রোধের মধ্য দিয়ে প্রবাহ। \`I_total\` হলো মোট প্রবাহ। \`Rp\` হলো \`Rₓ\` যে শাখায় আছে, তার সাথে সমান্তরালে থাকা অন্য সকল শাখার তুল্য রোধ।
    *   *দুইটি শাখার ক্ষেত্রে সহজ সূত্র:* \`R₁\` রোধের প্রবাহ \`I₁ = I_total × (R₂ / (R₁ + R₂))\`
*   **ভোল্টেজ ডিভাইডার:** \`Vₓ = V_total × (Rₓ / Rs)\`
    এখানে, \`Vₓ\` হলো \`Rₓ\` রোধের দুই প্রান্তের বিভব পতন। \`V_total\` হলো মোট বিভব। \`Rs\` হলো বর্তনীর মোট শ্রেণি রোধ।

**Common Mistakes & Tips:**

*   **ভুল:** কারেন্ট ডিভাইডার সূত্রে শিক্ষার্থীরা প্রায়ই \`Rp\`-এর জায়গায় ভুল মান বসায় বা \`Rₓ\`-এর মান উপরে দিয়ে ফেলে। মনে রাখতে হবে, কারেন্ট কম রোধের দিকে বেশি যায়, তাই সূত্রটি ব্যস্তানুপাতিক।
*   **টিপস:** ভোল্টেজ ডিভাইডার সূত্রটি শুধুমাত্র শ্রেণি সমবায়ের জন্য প্রযোজ্য। একইভাবে, কারেন্ট ডিভাইডার সূত্রটি সমান্তরাল সমবায়ের জন্য। জটিল বর্তনীতে আগে তুল্য রোধ বের করে মোট প্রবাহ বা বিভব বের করে নিতে হবে।

**Examples:**

**Example 1:** একটি 6 Ω এবং 3 Ω রোধের সমান্তরাল সমবায়ের মধ্যে দিয়ে 9A প্রবাহ যাচ্ছে। 3 Ω রোধের মধ্য দিয়ে কত প্রবাহ যাবে?
*   **ব্যবহৃত সূত্র:** Current Divider Rule
*   **Solution:**
    \`I_3Ω = I_total × (R_opposite / (R_self + R_opposite))\`
    \`I_3Ω = 9 × (6 / (3 + 6)) = 9 × (6/9) = 6 A\`

**Example 2:** একটি 12V ব্যাটারির সাথে 2 Ω এবং 4 Ω মানের দুটি রোধ শ্রেণিতে যুক্ত আছে। 4 Ω রোধের দুই প্রান্তের বিভব পার্থক্য কত?
*   **ব্যবহৃত সূত্র:** Voltage Divider Rule
*   **Solution:**
    \`V_4Ω = V_total × (R_self / R_total)\`
    \`V_4Ω = 12 × (4 / (2 + 4)) = 12 × (4/6) = 8 V\`

---

### **Type 03: হুইটস্টোন ব্রিজ (Wheatstone Bridge)**

**Concept:**
 চারটি রোধকে একটি চতুর্ভুজের চারটি বাহুতে যুক্ত করে এর যেকোনো এক কর্ণ বরাবর একটি গ্যালভানোমিটার এবং অপর কর্ণ বরাবর একটি ব্যাটারি যুক্ত করলে যে বর্তনী তৈরি হয়, তাকে হুইটস্টোন ব্রিজ বলে।
*   **সাম্যাবস্থা (Balanced Condition):** ব্রিজের সাম্যাবস্থায় গ্যালভানোমিটারের মধ্য দিয়ে কোনো তড়িৎ প্রবাহিত হয় না (\`Ig = 0\`)। এই অবস্থায়, গ্যালভানোমিটারের দুই প্রান্তের বিভব সমান হয়।
*   **সাম্যাবস্থার শর্ত:** \`P/Q = R/S\` (এখানে P, Q, R, S হলো চতুর্ভুজের চারটি বাহুর রোধ)।

**Common Mistakes & Tips:**

*   **ভুল:** বর্তনীতে P, Q, R, S রোধগুলো সঠিকভাবে চিহ্নিত করতে না পারা।
*   **টিপস:** সাম্যাবস্থায় থাকা হুইটস্টোন ব্রিজের তুল্য রোধ বের করার সময় গ্যালভানোমিটার বা মাঝের শাখার রোধটি বাদ দিয়ে হিসাব করতে হয়। তখন উপরের দুটি রোধ (P, Q) শ্রেণিতে এবং নিচের দুটি রোধ (R, S) শ্রেণিতে থাকে। এরপর এই দুটি শ্রেণি সমবায় পরস্পরের সাথে সমান্তরালে যুক্ত থাকে। \`Req = (P+Q)(R+S) / (P+Q+R+S)\`
*   **ট্রিকস:** অনেক জটিল বর্তনী দেখতে হুইটস্টোন ব্রিজের মতো না হলেও, সেগুলোকে রি-ড্র করে হুইটস্টোন ব্রিজের আকারে আনা যায়।

**Examples:**

**Example 1:** একটি হুইটস্টোন ব্রিজের তিন বাহুর রোধ যথাক্রমে 5 Ω, 10 Ω এবং 15 Ω। চতুর্থ বাহুতে কত মানের রোধ যুক্ত করলে ব্রিজটি সাম্যাবস্থায় থাকবে? (ধরে নাও, রোধগুলো ক্রমানুসারে P, Q, R)।
*   **ব্যবহৃত সূত্র:** \`P/Q = R/S\`
*   **Solution:**
    \`5 / 10 = 15 / S\`
    \`S = (15 × 10) / 5 = 30 Ω\`

**Example 2:** নিচের বর্তনীর A ও B প্রান্তের মধ্যে তুল্য রোধ কত?



*   **Solution Strategy:** প্রথমে ব্রিজটি সাম্যাবস্থায় আছে কি না তা পরীক্ষা করতে হবে। যদি থাকে, তবে মাঝের 10 Ω রোধটি বাদ দিয়ে হিসাব করতে হবে।
*   **Solution:**
    Step 1: শর্ত পরীক্ষা, \`P/Q = 4/8 = 1/2\` এবং \`R/S = 6/12 = 1/2\`। যেহেতু \`P/Q = R/S\`, ব্রিজটি সাম্যাবস্থায় আছে।
    Step 2: মাঝের 10 Ω রোধটি বাদ যাবে।
    Step 3: উপরের শাখায় \`Rs1 = 4 + 8 = 12 Ω\`। নিচের শাখায় \`Rs2 = 6 + 12 = 18 Ω\`।
    Step 4: এখন \`Rs1\` ও \`Rs2\` সমান্তরালে যুক্ত।
    \`Req = (12 × 18) / (12 + 18) = 216 / 30 = 7.2 Ω\`

---

### **Type 04: কার্শফের সূত্র (Kirchhoff's Laws)**

**Concept:**
জটিল বর্তনী, যেখানে রোধের শ্রেণি বা সমান্তরাল সমবায় সরাসরি বোঝা যায় না, সেখানে প্রবাহ ও বিভব নির্ণয়ের জন্য কার্শফের সূত্র ব্যবহার করা হয়।

*   **প্রথম সূত্র (KCL - Kirchhoff’s Current Law):** বর্তনীর কোনো সংযোগ বিন্দুতে (Junction) আগত প্রবাহমাত্রার সমষ্টি এবং নির্গত প্রবাহমাত্রার সমষ্টি সমান।
    *   **ভিত্তি:** এটি আধানের নিত্যতা বা সংরক্ষণশীলতা নীতির উপর প্রতিষ্ঠিত।
    *   গাণিতিক রূপ: \`Σ I_in = Σ I_out\`
*   **দ্বিতীয় সূত্র (KVL - Kirchhoff’s Voltage Law):** কোনো বদ্ধ বর্তনীর (Loop) বিভিন্ন অংশগুলোর রোধ এবং সংশ্লিষ্ট প্রবাহের গুণফলের বীজগাণিতিক সমষ্টি ওই বর্তনীর মোট তড়িচ্চালক শক্তির (EMF) বীজগাণিতিক সমষ্টির সমান।
    *   **ভিত্তি:** এটি শক্তির নিত্যতা বা সংরক্ষণশীলতা নীতির উপর প্রতিষ্ঠিত।
    *   গাণিতিক রূপ: \`Σ E = Σ (IR)\`

**Common Mistakes & Tips:**

*   **ভুল:** KVL প্রয়োগের সময় চিহ্ন নির্ধারণে ভুল করা। শিক্ষার্থীরা প্রায়ই বিভব বৃদ্ধি (voltage rise) এবং বিভব পতন (voltage drop) এর চিহ্ন উল্টাপাল্টা করে ফেলে।
*   **টিপস (চিহ্ন প্রথা):**
    1.  লুপ ঘোরার দিক নির্ধারণ করুন (ঘড়ির কাঁটার দিকে বা বিপরীতে)।
    2.  লুপ ঘোরার সময় যদি ব্যাটারির ঋণাত্মক প্রান্ত থেকে ধনাত্মক প্রান্তে যান, তবে EMF (+) ধরবেন। ধনাত্মক থেকে ঋণাত্মকে গেলে EMF (-) ধরবেন।
    3.  লুপ ঘোরার দিক এবং প্রবাহের দিক একই হলে, IR এর আগে (-) চিহ্ন বসবে (বিভব পতন)।
    4.  লুপ ঘোরার দিক এবং প্রবাহের দিক বিপরীত হলে, IR এর আগে (+) চিহ্ন বসবে (বিভব বৃদ্ধি)।
*   **ট্রিকস:** যে কোনো জটিল বর্তনীতে প্রথমে KCL ব্যবহার করে বিভিন্ন শাখার প্রবাহের মধ্যে সম্পর্ক স্থাপন করুন। এরপর প্রয়োজনীয় সংখ্যক লুপে KVL প্রয়োগ করে সমীকরণ সমাধান করুন।

**Example:**

**Example 1:** নিচের বর্তনীতে \`I₁\`, \`I₂\` এবং \`I₃\` এর মান নির্ণয় কর।



*   **Solution Strategy:** প্রথমে A বিন্দুতে KCL প্রয়োগ করতে হবে। এরপর বাম পাশের লুপে (Loop 1) এবং ডান পাশের লুপে (Loop 2) KVL প্রয়োগ করে তিনটি সমীকরণ সমাধান করতে হবে।
*   **Solution:**
    Step 1: A বিন্দুতে KCL প্রয়োগ করে: \`I₁ + I₂ = I₃\`  ... (i)

    Step 2: Loop 1 (বাম পাশ) এ KVL প্রয়োগ করে (ঘড়ির কাঁটার দিকে):
    \`-2I₁ - 4I₃ + 10 = 0\`
    \`2I₁ + 4I₃ = 10\`
    \`I₁ + 2I₃ = 5\` ... (ii)

    Step 3: Loop 2 (ডান পাশ) এ KVL প্রয়োগ করে (ঘড়ির কাঁটার বিপরীতে):
    \`-5I₂ - 4I₃ + 20 = 0\`
    \`5I₂ + 4I₃ = 20\` ... (iii)

    Step 4: এখন (i), (ii), (iii) নং সমীকরণ সমাধান করে \`I₁\`, \`I₂\`, \`I₃\` এর মান বের করতে হবে।
    (i) থেকে \`I₁ = I₃ - I₂\` (ii) এ বসিয়ে পাই:
    \`(I₃ - I₂) + 2I₃ = 5 => 3I₃ - I₂ = 5 => I₂ = 3I₃ - 5\`
    এই মান (iii) এ বসিয়ে:
    \`5(3I₃ - 5) + 4I₃ = 20\`
    \`15I₃ - 25 + 4I₃ = 20\`
    \`19I₃ = 45 => I₃ = 45/19 A ≈ 2.37 A\`

    \`I₂ = 3(45/19) - 5 = (135 - 95)/19 = 40/19 A ≈ 2.11 A\`
    \`I₁ = (45/19) - (40/19) = 5/19 A ≈ 0.26 A\`

---
### **Type 05: কোষের সমবায় (Combination of Cells)**

**Concept:**
একাধিক তড়িৎ কোষকে একত্রে যুক্ত করে ব্যবহার করাকে কোষের সমবায় বলে। এর মাধ্যমে বর্তনীতে প্রয়োজনীয় ভোল্টেজ বা কারেন্ট পাওয়া যায়।

*   **শ্রেণি সমবায় (Series Combination):** একটি কোষের ঋণাত্মক প্রান্ত অন্যটির ধনাত্মক প্রান্তের সাথে যুক্ত থাকলে এটি শ্রেণি সমবায়।
    *   **উদ্দেশ্য:** বর্তনীতে উচ্চ বিভব পার্থক্য বা ভোল্টেজ তৈরি করা।
    *   **তুল্য EMF:** \`Es = E₁ + E₂ + ...\`
    *   **তুল্য অভ্যন্তরীণ রোধ:** \`rs = r₁ + r₂ + ...\`
*   **সমান্তরাল সমবায় (Parallel Combination):** সকল কোষের ধনাত্মক প্রান্ত একটি বিন্দুতে এবং ঋণাত্মক প্রান্ত অন্য একটি বিন্দুতে যুক্ত থাকলে এটি সমান্তরাল সমবায়।
    *   **উদ্দেশ্য:** বর্তনীতে দীর্ঘ সময় ধরে প্রবাহ সরবরাহ করা বা উচ্চ প্রবাহ পাওয়া।
    *   **তুল্য EMF (যদি সব কোষের EMF সমান হয়):** \`Ep = E\`
    *   **তুল্য অভ্যন্তরীণ রোধ:** \`1/rp = 1/r₁ + 1/r₂ + ...\`
*   **মিশ্র সমবায় (Mixed Combination):** কিছু কোষ শ্রেণিতে এবং এমন একাধিক শ্রেণি শাখা পরস্পরের সাথে সমান্তরালে যুক্ত থাকলে তাকে মিশ্র সমবায় বলে।

**Formula:**
*   শ্রেণি সমবায়ে প্রবাহ: \`I = nE / (R + nr)\`
*   সমান্তরাল সমবায়ে প্রবাহ: \`I = E / (R + r/m)\` (m সংখ্যক কোষের জন্য)
*   মিশ্র সমবায়ে প্রবাহ: \`I = mnE / (mR + nr)\` (m সংখ্যক সারি ও n সংখ্যক কোষ প্রতি সারিতে)
*   মিশ্র সমবায়ে সর্বোচ্চ প্রবাহের শর্ত: \`mR = nr\` (বাহ্যিক রোধ = মোট অভ্যন্তরীণ রোধ)

**Common Mistakes & Tips:**

*   **ভুল:** সমান্তরাল সমবায়ে ভিন্ন মানের EMF যুক্ত কোষ থাকলে তুল্য EMF বের করার সাধারণ সূত্র \`E\` ব্যবহার করা। ভিন্ন EMF এর জন্য তুল্য EMF এর সূত্র হলো: \`Ep = (E₁/r₁ + E₂/r₂ + ...) / (1/r₁ + 1/r₂ + ...)\`
*   **টিপস:** কখন কোন সমবায় লাভজনক?
    *   যদি বাহ্যিক রোধ \`R\` অভ্যন্তরীণ রোধ \`r\` থেকে অনেক বড় হয় (\`R >> r\`), তবে **শ্রেণি সমবায়** বেশি প্রবাহ দেয়।
    *   যদি বাহ্যিক রোধ \`R\` অভ্যন্তরীণ রোধ \`r\` থেকে অনেক ছোট হয় (\`R << r\`), তবে **সমান্তরাল সমবায়** বেশি প্রবাহ দেয়।

**Examples:**

**Example 1:** 1.5V তড়িচ্চালক শক্তি এবং 0.5 Ω অভ্যন্তরীণ রোধের ৪টি কোষকে শ্রেণিতে যুক্ত করে 10 Ω রোধের সাথে যুক্ত করা হলো। প্রবাহ কত?
*   **ব্যবহৃত সূত্র:** \`I = nE / (R + nr)\`
*   **Solution:**
    \`n = 4, E = 1.5 V, r = 0.5 Ω, R = 10 Ω\`
    \`I = (4 × 1.5) / (10 + 4 × 0.5) = 6 / (10 + 2) = 6 / 12 = 0.5 A\`

**Example 2:** প্রতিটি 2V ও 0.2 Ω এর 24টি কোষ আছে। এগুলোকে কীভাবে সাজালে 1.2 Ω বাহ্যিক রোধের মধ্য দিয়ে সর্বোচ্চ প্রবাহ পাওয়া যাবে? সর্বোচ্চ প্রবাহের মান কত?
*   **Solution Strategy:** সর্বোচ্চ প্রবাহের জন্য মিশ্র সমবায়ের শর্ত \`mR = nr\` ব্যবহার করতে হবে। মোট কোষ \`mn = 24\`।
*   **Solution:**
    \`mR = nr => m × 1.2 = n × 0.2 => n = 6m\`
    আমরা জানি, \`mn = 24 => m(6m) = 24 => 6m² = 24 => m² = 4 => m = 2\`
    সুতরাং, \`n = 6 × 2 = 12\`
    অর্থাৎ, ২টি সারিতে প্রতি সারিতে 12টি করে কোষ সাজাতে হবে।

    সর্বোচ্চ প্রবাহ, \`I_max = mnE / (mR + nr)\`
    \`I_max = (24 × 2) / (2 × 1.2 + 12 × 0.2) = 48 / (2.4 + 2.4) = 48 / 4.8 = 10 A\`

### **Type-07: মিটার ব্রিজ (Meter Bridge)**

#### **Concept**
মিটার ব্রিজ হুইটস্টোন ব্রিজ নীতির একটি সরল ও ব্যবহারিক রূপ। এটি ব্যবহার করে কোনো অজানা রোধের মান অত্যন্ত নিখুঁতভাবে নির্ণয় করা যায়।
*   **গঠন:** এখানে 1 মিটার (100 cm) দীর্ঘ একটি সুষম প্রস্থচ্ছেদের তার ব্যবহার করা হয়।
*   **কার্যনীতি:** হুইটস্টোন ব্রিজের সাম্যাবস্থার শর্ত এখানে প্রয়োগ করা হয়। যদি অজানা রোধ \`X\` এবং জানা রোধ \`R\`-এর জন্য নিস্পন্দ বিন্দু (Null Point) \`l\` দূরত্বে পাওয়া যায়, তবে:
    \`X / R = l / (100 - l)\`
    এখানে \`l\` হলো অজানা রোধের প্রান্ত থেকে নিস্পন্দ বিন্দুর দূরত্ব (cm এককে)।

#### **Common Mistakes & Tips**
*   **Mistake:** \`l\`-এর মান কোন প্রান্ত থেকে মাপা হচ্ছে, সেদিকে খেয়াল না রাখা। সূত্রটি তখনই প্রযোজ্য যখন \`l\` অজানা রোধের (\`X\`) প্রান্ত থেকে মাপা হয়। যদি জানা রোধের প্রান্ত থেকে দূরত্ব দেওয়া থাকে, তবে \`l\` এর মান হবে \`(100 - প্রদত্ত দূরত্ব)\`।
*   **Mistake:** সূত্র ব্যবহারের সময় \`l\`-কে মিটার এককে নেওয়া। মনে রাখতে হবে, এটি একটি অনুপাত, তাই \`l\` এবং \`(100-l)\` উভয়ই cm এককে থাকলেই চলবে।
*   **Tip:** নিস্পন্দ বিন্দু তারের মাঝামাঝি (40 cm থেকে 60 cm এর মধ্যে) পাওয়া গেলে পাঠ সবচেয়ে নির্ভুল হয়। তাই জানা রোধ \`R\`-এর মান এমনভাবে নির্বাচন করা উচিত যেন নিস্পন্দ বিন্দু মাঝামাঝি থাকে।

#### **Examples (Progressive Difficulty)**

**Example 1 (Easy):**
*   **Question:** একটি মিটার ব্রিজের বাম ফাঁকে একটি অজানা রোধ এবং ডান ফাঁকে 12 Ω মানের একটি জানা রোধ যুক্ত আছে। বাম প্রান্ত থেকে 40 cm দূরে নিস্পন্দ বিন্দু পাওয়া গেলে অজানা রোধের মান কত?
*   **Formula to use:** \`X / R = l / (100 - l)\`
*   **Solution:**
    এখানে, R = 12 Ω, l = 40 cm
    \`X / 12 = 40 / (100 - 40)\`
    \`X / 12 = 40 / 60 = 2/3\`
    \`X = (2/3) × 12 = 8 Ω\`

**Example 2 (Medium):**
*   **Question:** একটি মিটার ব্রিজের দুই ফাঁকে \`R₁\` ও \`R₂\` রোধ যুক্ত করলে নিস্পন্দ বিন্দু 50 cm-এ পাওয়া যায়। \`R₁\`-এর সাথে 10 Ω রোধ শ্রেণিতে যুক্ত করলে নিস্পন্দ বিন্দু 60 cm-এ সরে যায়। \`R₁\` ও \`R₂\`-এর মান নির্ণয় কর।
*   **Formula to use:** \`X / R = l / (100 - l)\`
*   **Solution:**
    Step 1: প্রথম শর্তানুযায়ী
    \`R₁ / R₂ = 50 / (100 - 50) = 50 / 50 = 1\`
    ⇒ \`R₁ = R₂\`

    Step 2: দ্বিতীয় শর্তানুযায়ী
    নতুন অজানা রোধ \`X = R₁ + 10\`। নিস্পন্দ বিন্দু \`l = 60 cm\`।
    \`(R₁ + 10) / R₂ = 60 / (100 - 60) = 60 / 40 = 3/2\`
    যেহেতু \`R₁ = R₂\`, আমরা পাই:
    \`(R₁ + 10) / R₁ = 3/2\`
    \`2(R₁ + 10) = 3R₁\`
    \`2R₁ + 20 = 3R₁\`
    \`R₁ = 20 Ω\`
    সুতরাং, \`R₂ = R₁ = 20 Ω\`।

**Example 3 (Hard):**
*   **Question:** একটি মিটার ব্রিজের তারের রোধ 4 Ω। এর বাম ও ডান ফাঁকে যথাক্রমে 2 Ω এবং 3 Ω রোধ যুক্ত আছে। ব্রিজটিকে সাম্যাবস্থায় আনতে হলে 3 Ω রোধের সাথে কত মানের রোধ কীভাবে যুক্ত করতে হবে?
*   **Formula to use:** হুইটস্টোন ব্রিজের সাম্যাবস্থার শর্ত।
*   **Solution:**
    ধরি, সাম্যাবস্থার জন্য নিস্পন্দ বিন্দু \`l\` দূরত্বে পাওয়া যাবে।
    ব্রিজের বাম দিকের রোধ \`P = 2 Ω\`।
    ডান দিকের রোধ \`Q\` এর মান পরিবর্তন করতে হবে।
    শর্ত \`P/Q = l/(100-l)\`।
    সবচেয়ে ভালো সাম্যাবস্থার জন্য \`l\` কে 50 cm এর কাছাকাছি রাখা উচিত।
    যদি \`l=40 cm\` হয় (2 Ω এর কাছাকাছি), তাহলে:
    \`2 / Q = 40 / 60 = 2/3\`
    \`Q = 3 Ω\`।
    কিন্তু আমাদের ডান ফাঁকে আগে থেকেই 3 Ω রোধ আছে। এখন প্রশ্ন হলো, এটিকে পরিবর্তন করে কত বানাতে হবে?
    ধরি, 3 Ω রোধের সাথে \`x\` মানের রোধ সমান্তরালে যুক্ত করতে হবে। নতুন রোধ হবে \`Q'\`।
    যদি সাম্যাবস্থা 40 cm এ আনতে হয়, তাহলে \`Q'\` কে 3 Ω বানাতে হবে।
    \`2 / Q' = 40 / 60\` ⇒ \`Q' = 3 Ω\`।
    আমাদের কাছে আছে 3 Ω, বানাতে হবে 3 Ω। অর্থাৎ, কোনো রোধ যুক্ত করার প্রয়োজন নেই, যদি নিস্পন্দ বিন্দু 40 cm-এ পাওয়া যায়।
    কিন্তু যদি প্রশ্ন হয়, 3 Ω এর সাথে \`x\` রোধ সমান্তরালে যুক্ত করায় নিস্পন্দ বিন্দু 25 cm এ পাওয়া গেল, \`x\` এর মান কত?
    \`P = 2 Ω\`, \`l = 25 cm\`। \`Q' = (3x)/(3+x)\`
    \`2 / ((3x)/(3+x)) = 25 / (100-25) = 25/75 = 1/3\`
    \`2(3+x) / 3x = 1/3\`
    \`6(3+x) = 3x\`
    \`18 + 6x = 3x\`
    \`3x = -18\` ⇒ \`x = -6 Ω\`। এটি অসম্ভব।
    অর্থাৎ, নিস্পন্দ বিন্দু বাম দিকে সরানোর জন্য ডান দিকের রোধ বাড়াতে হবে। তাই রোধ শ্রেণিতে যুক্ত করতে হবে।
    ধরি, 3 Ω এর সাথে \`x\` রোধ শ্রেণিতে যুক্ত করায় নিস্পন্দ বিন্দু 60 cm এ পাওয়া গেল।
    \`P = 2 Ω\`, \`l = 60 cm\`। \`Q' = 3 + x\`
    \`2 / (3+x) = 60 / 40 = 3/2\`
    \`4 = 3(3+x)\`
    \`4 = 9 + 3x\` ⇒ \`3x = -5\`। এটিও অসম্ভব।
    (এই সমস্যাটি একটি কনসেপচুয়াল ধাঁধা। সাম্যাবস্থা আনতে হলে ডানদিকের রোধটি পরিবর্তন করতে হবে, কিন্তু কীভাবে তা নির্ভর করবে নিস্পন্দ বিন্দুর কাঙ্ক্ষিত অবস্থানের উপর।)

---

### **Type-08: পটেনশিওমিটার (Potentiometer)**

#### **Concept**
পটেনশিওমিটার একটি আদর্শ ভোল্টমিটার হিসেবে কাজ করে, যা বর্তনী থেকে কোনো তড়িৎ প্রবাহ না টেনে কোনো কোষের তড়িচ্চালক শক্তি (EMF) বা বিভব পার্থক্য সঠিকভাবে পরিমাপ করতে পারে।
*   **মূলনীতি:** এর সুষম তারের মধ্য দিয়ে স্থির প্রবাহ চললে, তারের যেকোনো অংশের বিভব পতন ঐ অংশের দৈর্ঘ্যের সমানুপাতিক (\`V ∝ L\`)।
*   **বিভব নতি (Potential Gradient), k:** তারের প্রতি একক দৈর্ঘ্যে বিভব পতনকে বিভব নতি বলে। \`k = V/L\` (Volt/meter)।
*   **ব্যবহার ও সূত্র:**
    1.  **দুটি কোষের তড়িচ্চালক শক্তির তুলনা:** \`E₁ / E₂ = l₁ / l₂\`
    2.  **কোষের অভ্যন্তরীণ রোধ নির্ণয়:** \`r = R ( (l₁/l₂) - 1 )\`
        এখানে,
        *   \`E₁\`, \`E₂\` = কোষ দুটির তড়িচ্চালক শক্তি
        *   \`l₁\`, \`l₂\` = কোষ দুটির জন্য নিস্পন্দ বিন্দুর দূরত্ব
        *   \`r\` = কোষের অভ্যন্তরীণ রোধ
        *   \`R\` = কোষের সাথে যুক্ত শান্ট রোধ (Shunt resistance)

#### **Common Mistakes & Tips**
*   **Mistake:** অভ্যন্তরীণ রোধ নির্ণয়ের সূত্রে \`l₁\` ও \`l₂\` কোনটি কী, তা গুলিয়ে ফেলা। মনে রাখবে, \`l₁\` হলো যখন কোষটি খোলা (শুধু EMF), এবং \`l₂\` হলো যখন শান্ট রোধ \`R\` যুক্ত করা হয়। যেহেতু শান্ট লাগালে কোষের টার্মিনাল ভোল্টেজ কমে যায়, তাই \`l₂\` সবসময় \`l₁\` থেকে ছোট হবে (\`l₁ > l₂\`)।
*   **Tip:** পটেনশিওমিটারের চালক কোষের (Driver cell) তড়িচ্চালক শক্তি অবশ্যই পরীক্ষাধীন কোষের (যে কোষের EMF মাপা হচ্ছে) তড়িচ্চালক শক্তির চেয়ে বেশি হতে হবে। নতুবা নিস্পন্দ বিন্দু তারের উপর কোথাও পাওয়া যাবে না।
*   **Tip:** পটেনশিওমিটারের তার যত লম্বা হবে, এর সুবেদিতা (sensitivity) তত বাড়বে এবং পরিমাপ তত নির্ভুল হবে।

#### **Examples (Progressive Difficulty)**

**Example 1 (Easy):**
*   **Question:** একটি পটেনশিওমিটারের সাহায্যে 1.25 V তড়িচ্চালক শক্তির একটি প্রমাণ কোষের জন্য নিস্পন্দ বিন্দু 35 cm দূরে পাওয়া যায়। অন্য একটি কোষের জন্য নিস্পন্দ বিন্দু 63 cm দূরে পাওয়া গেলে, ঐ কোষের তড়িচ্চালক শক্তি কত?
*   **Formula to use:** \`E₁ / E₂ = l₁ / l₂\`
*   **Solution:**
    \`E₁ = 1.25 V, l₁ = 35 cm, l₂ = 63 cm, E₂ = ?\`
    \`1.25 / E₂ = 35 / 63\`
    \`E₂ = 1.25 × (63 / 35) = 1.25 × (9 / 5) = 2.25 V\`

**Example 2 (Medium):**
*   **Question:** একটি কোষকে পটেনশিওমিটারে যুক্ত করলে 240 cm দূরে নিস্পন্দ বিন্দু পাওয়া যায়। কোষটির দুই প্রান্তের সাথে 2 Ω মানের একটি রোধ যুক্ত করলে নিস্পন্দ বিন্দু 120 cm দূরে পাওয়া যায়। কোষটির অভ্যন্তরীণ রোধ কত?
*   **Formula to use:** \`r = R ( (l₁/l₂) - 1 )\`
*   **Solution:**
    \`l₁ = 240 cm, R = 2 Ω, l₂ = 120 cm\`
    \`r = 2 × ( (240/120) - 1 )\`
    \`r = 2 × (2 - 1) = 2 × 1 = 2 Ω\`

**Example 3 (Hard):**
*   **Question:** একটি পটেনশিওমিটারের তার 4 m লম্বা এবং এর রোধ 8 Ω। এর সাথে 2V তড়িচ্চালক শক্তির একটি চালক কোষ এবং 2 Ω মানের একটি রোধ শ্রেণিতে যুক্ত আছে। তারটির বিভব নতি (potential gradient) কত?
*   **Formula to use:** \`k = V_wire / L_wire\` এবং \`V_wire = I × R_wire\`
*   **Solution:**
    Step 1: বর্তনীর মোট প্রবাহ \`I\` নির্ণয়
    মোট রোধ \`R_total = R_wire + R_series = 8 Ω + 2 Ω = 10 Ω\`
    চালক কোষের EMF, E = 2V
    \`I = E / R_total = 2 / 10 = 0.2 A\`

    Step 2: পটেনশিওমিটার তারের দুই প্রান্তের বিভব পার্থক্য \`V_wire\` নির্ণয়
    \`V_wire = I × R_wire = 0.2 A × 8 Ω = 1.6 V\`

    Step 3: বিভব নতি \`k\` নির্ণয়
    তারের দৈর্ঘ্য L_wire = 4 m
    \`k = V_wire / L_wire = 1.6 V / 4 m = 0.4 V/m\`

---

### **Type-09/10: গ্যালভানোমিটার থেকে অ্যামিটার ও ভোল্টমিটার (Ammeter & Voltmeter from Galvanometer)**

#### **Concept**
*   **অ্যামিটার (Ammeter):** গ্যালভানোমিটারকে অ্যামিটারে পরিণত করতে এর সাথে সমান্তরালে একটি স্বল্প মানের রোধ যুক্ত করা হয়, যাকে **শান্ট (Shunt)** বলে। শান্ট মূল প্রবাহের প্রায় সবটুকু নিজের মধ্য দিয়ে প্রবাহিত করে গ্যালভানোমিটারকে রক্ষা করে।
    *   **শান্টের সূত্র:** \`S = (I_g G) / (I - I_g)\`
    *   \`I\` = মোট প্রবাহ (অ্যামিটারের পাল্লা), \`I_g\` = গ্যালভানোমিটারের পূর্ণ স্কেল বিক্ষেপ প্রবাহ, \`G\` = গ্যালভানোমিটারের রোধ।

*   **ভোল্টমিটার (Voltmeter):** গ্যালভানোমিটারকে ভোল্টমিটারে পরিণত করতে এর সাথে শ্রেণিতে একটি উচ্চ মানের রোধ \`(R_s)\` যুক্ত করা হয়। এই উচ্চ রোধ বর্তনীর বিভবকে সীমিত করে গ্যালভানোমিটারকে উচ্চ ভোল্টেজ থেকে রক্ষা করে।
    *   **উচ্চ রোধের সূত্র:** \`R_s = (V / I_g) - G\`
    *   \`V\` = মোট বিভব (ভোল্টমিটারের পাল্লা)।

#### **Common Mistakes & Tips**
*   **Mistake:** শান্টকে শ্রেণিতে এবং উচ্চ রোধকে সমান্তরালে যুক্ত করে ফেলা। মনে রাখবে: **অ্যামিটার = সমান্তরালে শান্ট (কম রোধ)**, **ভোল্টমিটার = শ্রেণিতে উচ্চ রোধ**।
*   **Tip:** একটি আদর্শ অ্যামিটারের রোধ শূন্য এবং একটি আদর্শ ভোল্টমিটারের রোধ অসীম। বাস্তবে, অ্যামিটারের রোধ খুব কম এবং ভোল্টমিটারের রোধ খুব বেশি হওয়া প্রয়োজন।

#### **Examples (Progressive Difficulty)**

**Example 1 (Easy):**
*   **Question:** একটি গ্যালভানোমিটারের রোধ 100 Ω এবং এটি 1 mA প্রবাহে পূর্ণ স্কেল বিক্ষেপ দেয়। এটিকে কীভাবে (a) 5 A পাল্লার অ্যামিটার এবং (b) 10 V পাল্লার ভোল্টমিটারে রূপান্তর করবে?
*   **Formula to use:** শান্ট ও উচ্চ রোধের সূত্র।
*   **Solution:**
    দেওয়া আছে, G = 100 Ω, I_g = 1 mA = 10⁻³ A
    (a) **অ্যামিটারের জন্য (I = 5 A):**
    \`S = (I_g G) / (I - I_g) = (10⁻³ × 100) / (5 - 10⁻³) = 0.1 / 4.999 ≈ 0.02 Ω\`
    অর্থাৎ, গ্যালভানোমিটারের সাথে সমান্তরালে 0.02 Ω মানের শান্ট যুক্ত করতে হবে।

    (b) **ভোল্টমিটারের জন্য (V = 10 V):**
    \`R_s = (V / I_g) - G = (10 / 10⁻³) - 100 = 10000 - 100 = 9900 Ω\`
    অর্থাৎ, গ্যালভানোমিটারের সাথে শ্রেণিতে 9900 Ω মানের রোধ যুক্ত করতে হবে।

**Example 2 (Medium):**
*   **Question:** একটি অ্যামিটারের পাল্লা 1% বৃদ্ধি করতে হলে এর শান্টের মানের কী পরিবর্তন করতে হবে?
*   **Formula to use:** \`S ∝ 1/I\` (প্রায়)
*   **Solution:**
    আমরা জানি \`S = I_g G / (I - I_g)\`। যদি \`I >> I_g\` হয়, তবে \`S ≈ I_g G / I\`।
    সুতরাং, \`S ∝ 1/I\`।
    ধরি, প্রাথমিক পাল্লা \`I₁\` এবং শান্ট \`S₁\`। নতুন পাল্লা \`I₂ = I₁ + 0.01I₁ = 1.01I₁\`।
    \`S₂ / S₁ = I₁ / I₂ = I₁ / (1.01I₁) = 1 / 1.01 ≈ 0.99\`
    \`S₂ = 0.99 S₁\`।
    অর্থাৎ, শান্টের মানকে পূর্বের মানের 99% করতে হবে, বা 1% কমাতে হবে।

**Example 3 (Hard):**
*   **Question:** একটি 100 V পাল্লার ভোল্টমিটারের রোধ 20 kΩ। এটিকে 200 V পাল্লার ভোল্টমিটারে পরিণত করতে কত মানের রোধ কীভাবে যুক্ত করতে হবে?
*   **Formula to use:** \`R_s = (V / I_g) - G\` এবং \`V = I_g R_total\`
*   **Solution:**
    Step 1: ভোল্টমিটারের পূর্ণ স্কেল বিক্ষেপ প্রবাহ \`I_g\` বের করা।
    ভোল্টমিটারটি মূলত একটি গ্যালভানোমিটার ও একটি সিরিজ রোধের সমষ্টি। এর মোট রোধ \`R_v = 20 kΩ = 20000 Ω\`।
    \`V = I_g R_v\`
    \`100 = I_g × 20000\`
    \`I_g = 100 / 20000 = 1/200 = 0.005 A\`

    Step 2: নতুন পাল্লার জন্য প্রয়োজনীয় মোট রোধ \`R_total'\` বের করা।
    নতুন পাল্লা V' = 200 V।
    \`V' = I_g × R_total'\`
    \`200 = 0.005 × R_total'\`
    \`R_total' = 200 / 0.005 = 40000 Ω = 40 kΩ\`

    Step 3: অতিরিক্ত রোধ \`R_add\` বের করা।
    ভোল্টমিটারের অভ্যন্তরীণ রোধ আগে থেকেই 20 kΩ আছে। মোট রোধ প্রয়োজন 40 kΩ।
    \`R_add = R_total' - R_v = 40 kΩ - 20 kΩ = 20 kΩ\`
    সুতরাং, ভোল্টমিটারটির সাথে শ্রেণিতে আরও 20 kΩ রোধ যুক্ত করতে হবে।

---

### **Type-11: জুলের তাপীয় ক্রিয়া ও বৈদ্যুতিক ক্ষমতা (Joule's Heating & Electric Power)**

#### **Concept**
*   **জুলের তাপীয় ক্রিয়া:** কোনো রোধের মধ্য দিয়ে তড়িৎ প্রবাহিত হলে তাপ উৎপন্ন হয়। উৎপন্ন তাপ \`(H)\` প্রবাহ \`(I)\`, রোধ \`(R)\` এবং সময় \`(t)\`-এর উপর নির্ভর করে।
    *   **সূত্র:** \`H = I²Rt\` (একক Joule)। ক্যালরিতে নিতে হলে 4.2 দিয়ে ভাগ করতে হয়।
*   **বৈদ্যুতিক ক্ষমতা (Power, P):** কাজ করার হারকে ক্ষমতা বলে। বৈদ্যুতিক যন্ত্রের ক্ষেত্রে, এটি শক্তি রূপান্তরের হার।
    *   **সূত্র:** \`P = VI = I²R = V²/R\` (একক Watt)।

#### **Common Mistakes & Tips**
*   **Mistake:** ক্ষমতা ও শক্তির মধ্যে পার্থক্য না বোঝা। ক্ষমতা হলো প্রতি সেকেন্ডে ব্যয়িত শক্তি। শক্তি = ক্ষমতা × সময়।
*   **Tip:** যন্ত্রের গায়ে লেখা রেটিং (যেমন, 100W-220V) থেকে তার রোধ বের করা যায়, যা সাধারণত স্থির থাকে। \`R = V_rated² / P_rated\`। এই রোধ ব্যবহার করে অন্য যেকোনো ভোল্টেজে প্রকৃত ক্ষমতা বের করা যায়।
*   **Tricks:**
    *   শ্রেণি সমবায়ে \`P ∝ R\` (যেহেতু \`I\` স্থির)। তাই বেশি রোধের যন্ত্রের ক্ষমতা বেশি হবে।
    *   সমান্তরাল সমবায়ে \`P ∝ 1/R\` (যেহেতু \`V\` স্থির)। তাই কম রোধের যন্ত্রের ক্ষমতা বেশি হবে।
    *   যেসব বাল্বের ওয়াট (ক্ষমতা) কম, তাদের রোধ বেশি। তাই শ্রেণিতে যুক্ত করলে কম ওয়াটের বাল্ব বেশি আলো দেয়। সমান্তরালে যুক্ত করলে বেশি ওয়াটের বাল্ব বেশি আলো দেয় (যেমন বাসার সংযোগ)।

#### **Examples (Progressive Difficulty)**

**Example 1 (Easy):**
*   **Question:** একটি 220V-100W বাল্বকে 110V লাইনে যুক্ত করলে কত ক্ষমতা ব্যয় হবে?
*   **Formula to use:** \`R = V²/P\` এবং \`P_actual = V_actual²/R\`
*   **Solution:**
    Step 1: বাল্বের রোধ নির্ণয়
    \`R = V_rated² / P_rated = (220)² / 100 = 48400 / 100 = 484 Ω\`
    Step 2: নতুন ক্ষমতা নির্ণয়
    \`P_actual = V_actual² / R = (110)² / 484 = 12100 / 484 = 25 W\`

**Example 2 (Medium):**
*   **Question:** 220V-40W এবং 220V-100W রেটিং এর দুটি বাল্বকে 220V লাইনের সাথে শ্রেণিতে যুক্ত করা হলো। কোনটি বেশি উজ্জ্বলভাবে জ্বলবে?
*   **Formula to use:** \`R = V²/P\` এবং \`P = I²R\`
*   **Solution:**
    40W বাল্বের রোধ, \`R₁ = (220)² / 40 = 1210 Ω\`
    100W বাল্বের রোধ, \`R₂ = (220)² / 100 = 484 Ω\`
    যেহেতু বাল্ব দুটি শ্রেণিতে যুক্ত, তাদের মধ্য দিয়ে একই প্রবাহ \`(I)\` যাবে।
    ক্ষমতা ব্যয় \`P = I²R\`। সুতরাং \`P ∝ R\`।
    যেহেতু \`R₁ > R₂\`, তাই 40W বাল্বটি বেশি ক্ষমতা ব্যয় করবে এবং বেশি উজ্জ্বলভাবে জ্বলবে।

**Example 3 (Hard):**
*   **Question:** একটি হিটারের সাহায্যে 1 লিটার পানিকে 20°C থেকে 100°C তাপমাত্রায় উন্নীত করতে 5 মিনিট সময় লাগে। হিটারের রোধ 50 Ω হলে এর মধ্য দিয়ে প্রবাহ কত ছিল? (পানির আপেক্ষিক তাপ = 4200 Jkg⁻¹K⁻¹)।
*   **Formula to use:** \`H = I²Rt\` এবং \`H = msΔθ\`
*   **Solution:**
    প্রয়োজনীয় তাপ \`H = msΔθ\`
    m = 1 লিটার পানি = 1 kg
    s = 4200 Jkg⁻¹K⁻¹
    Δθ = 100°C - 20°C = 80°C = 80 K
    \`H = 1 × 4200 × 80 = 336000 J\`

    সরবরাহকৃত তাপ \`H = I²Rt\`
    R = 50 Ω
    t = 5 min = 5 × 60 = 300 s
    \`336000 = I² × 50 × 300\`
    \`I² = 336000 / 15000 = 22.4\`
    \`I = √22.4 ≈ 4.73 A\`

---

### **Type-12: বিদ্যুৎ বিল হিসাব (Calculating Electricity Bills)**

#### **Concept**
বাসাবাড়ি বা কলকারখানায় ব্যবহৃত বিদ্যুৎ শক্তির হিসাব করা হয় **কিলোওয়াট-ঘণ্টা (kWh)** এককে। একে **বোর্ড অফ ট্রেড ইউনিট (BOT unit)** বা সংক্ষেপে শুধু 'ইউনিট' বলা হয়।
*   **1 Unit = 1 kWh**
*   \`1 kWh = 3.6 × 10⁶ Joule\`
*   **ব্যয়িত শক্তি (ইউনিট):** \`E (kWh) = (ক্ষমতা (W) × সময় (h)) / 1000\`
*   **মোট বিল:** মোট ইউনিট × প্রতি ইউনিটের মূল্য

#### **Common Mistakes & Tips**
*   **Mistake:** ক্ষমতাকে ওয়াট (W) থেকে কিলোওয়াট (kW)-এ রূপান্তর না করা। সবসময় 1000 দিয়ে ভাগ করতে হবে।
*   **Mistake:** সময়কে ঘণ্টা (hour)-এ না রেখে মিনিট বা সেকেন্ডে হিসাব করা।
*   **Tip:** মাস উল্লেখ থাকলে (যেমন: জুন মাস), সেই মাসে মোট কত দিন (যেমন: ৩০ দিন) তা সঠিকভাবে হিসাব করতে হবে।

#### **Examples (Progressive Difficulty)**

**Example 1 (Easy):**
*   **Question:** একটি বাড়িতে প্রতিদিন ৪টি 40W বাতি ৫ ঘণ্টা করে এবং ২টি 80W পাখা ১০ ঘণ্টা করে চলে। প্রতি ইউনিট বিদ্যুতের দাম ৫ টাকা হলে, জুন মাসে (৩০ দিন) মোট বিল কত আসবে?
*   **Formula to use:** \`E = (P × t) / 1000\`
*   **Solution:**
    বাতির জন্য দৈনিক ব্যয়িত শক্তি = (4 × 40W × 5h) / 1000 = 800 / 1000 = 0.8 kWh
    পাখার জন্য দৈনিক ব্যয়িত শক্তি = (2 × 80W × 10h) / 1000 = 1600 / 1000 = 1.6 kWh
    দৈনিক মোট ব্যয়িত শক্তি = 0.8 + 1.6 = 2.4 kWh
    জুন মাসে (৩০ দিন) মোট ব্যয়িত শক্তি = 2.4 × 30 = 72 kWh = 72 ইউনিট
    মোট বিল = 72 × 5 = 360 টাকা।

**Example 2 (Medium):**
*   **Question:** একজন লোক 1 টন এসি (ক্ষমতা 1.2 kW) দৈনিক গড়ে 8 ঘণ্টা চালান। এছাড়া তার বাসায় অন্যান্য যন্ত্রপাতিতে মাসে 150 ইউনিট বিদ্যুৎ খরচ হয়। প্রতি ইউনিটের গড় মূল্য 7.5 টাকা হলে তার মাসিক বিল কত? (মাস = ৩০ দিন)।
*   **Formula to use:** \`E = P(kW) × t(h)\`
*   **Solution:**
    এসির জন্য দৈনিক খরচ = 1.2 kW × 8 h = 9.6 kWh
    এসির জন্য মাসিক (৩০ দিন) খরচ = 9.6 × 30 = 288 kWh
    অন্যান্য খরচ = 150 kWh
    মাসে মোট খরচ = 288 + 150 = 438 ইউনিট
    মোট বিল = 438 × 7.5 = 3285 টাকা।

**Example 3 (Hard):**
*   **Question:** একটি বাড়িতে 220V সাপ্লাই লাইনে 10A ফিউজ লাগানো আছে। ঐ বাড়িতে 60W এর ৫টি বাতি ও 100W এর ৪টি পাখা একত্রে চালানো হয়। ঐ অবস্থায় 750W এর একটি ইস্ত্রি চালানো যাবে কি? যদি চালানো হয়, তবে ৫ মিনিটে ফিউজটি কতটুকু তাপ উৎপন্ন করে গলে যাবে? (ফিউজের রোধ 0.2 Ω)।
*   **Formula to use:** \`P = VI\` and \`H = I²Rt\`
*   **Solution:**
    Step 1: বাতি ও পাখার জন্য মোট প্রবাহ নির্ণয়
    বাতি ও পাখার মোট ক্ষমতা = (5 × 60) + (4 × 100) = 300 + 400 = 700 W
    এই অবস্থায় প্রবাহ \`I₁ = P/V = 700 / 220 ≈ 3.18 A\`

    Step 2: ইস্ত্রি সহ মোট প্রবাহ নির্ণয়
    ইস্ত্রি সহ মোট ক্ষমতা = 700 + 750 = 1450 W
    মোট প্রবাহ \`I_total = P_total / V = 1450 / 220 ≈ 6.59 A\`
    যেহেতু মোট প্রবাহ 6.59 A, যা ফিউজের রেটিং 10A এর চেয়ে কম, তাই ইস্ত্রিটি চালানো যাবে।

    Step 3: ভুলবশত যদি প্রবাহ 10A এর বেশি হতো, তবে উৎপন্ন তাপ
    (এটি একটি কাল্পনিক অংশ, কারণ উপরের হিসাবে ফিউজ উড়বে না। কিন্তু প্রশ্ন যদি এমন হতো যে মোট প্রবাহ 12A হয়, তাহলে...)
    ধরি, মোট প্রবাহ I = 12A
    ফিউজের রোধ R = 0.2 Ω
    সময় t = 5 min = 300 s
    উৎপন্ন তাপ \`H = I²Rt = (12)² × 0.2 × 300 = 144 × 60 = 8640 J\`। এই তাপে ফিউজটি গলে যাবে।

`;
      
      const $ = (selector) => document.querySelector(selector);
      const modalOverlay = $("#custom-modal-overlay");
      const modalMessage = $("#modal-message");
      const modalConfirmBtn = $("#modal-confirm-btn");
      const modalCancelBtn = $("#modal-cancel-btn");
      
      // --- NEW: Element references for view switching ---
      const markdownViewer = $('#markdown-viewer');
      const chatMessagesContainer = $('#chat-messages');
      const chatFormContainer = $('#chat-form-container');
      const viewNotesBtn = $('#view-notes-btn');
      const tutorModeBtn = $('#tutor-mode-btn');

      let confirmCallback = null;
      let currentChatHistory = [];
      let allChats = {};
      let activeChatId = null;
      let uploadedFiles = [];
      let isTutorMode = false;

      function showConfirmationModal(message, onConfirm, isDanger = false) {
        modalMessage.textContent = message;
        confirmCallback = onConfirm;
        modalConfirmBtn.classList.toggle("danger", isDanger);
        modalOverlay.classList.add("open");
      }

      function hideConfirmationModal() {
        modalOverlay.classList.remove("open");
        confirmCallback = null;
      }

      function showNotification(message) {
        const notification = document.createElement("div");
        notification.textContent = message;
        notification.style.cssText = `position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background-color: var(--error-color); color: white; padding: 10px 20px; border-radius: 8px; z-index: 1001; opacity: 0; transition: opacity 0.3s ease, transform 0.3s ease; transform: translate(-50%, -20px);`;
        document.body.appendChild(notification);
        setTimeout(() => {
          notification.style.opacity = 1;
          notification.style.transform = "translateX(-50%)";
        }, 10);
        setTimeout(() => {
          notification.style.opacity = 0;
          notification.style.transform = "translate(-50%, -20px)";
          setTimeout(() => notification.remove(), 300);
        }, 3000);
      }
      
      // --- NEW & IMPROVED: Centralized Content Rendering Function ---
      function renderContent(element, markdownText) {
          // Step 1: Parse Markdown to HTML
          element.innerHTML = marked.parse(markdownText);
          
          // Step 2: Render LaTeX within the newly created HTML
          try {
              if (window.renderMathInElement) {
                  renderMathInElement(element, {
                      delimiters: [
                          { left: "$$", right: "$$", display: true },
                          { left: "\\[", right: "\\]", display: true },
                          { left: "$", right: "$", display: false },
                          { left: "\\(", right: "\\)", display: false },
                      ],
                      throwOnError: false,
                  });
              }
          } catch (e) {
              console.error("KaTeX rendering error:", e);
          }
      }

      function setupEventListeners() {
        document.addEventListener("DOMContentLoaded", () => {
          marked.setOptions({
            highlight: function (code, lang) {
              const language = hljs.getLanguage(lang) ? lang : "plaintext";
              return hljs.highlight(code, { language }).value;
            },
            langPrefix: "hljs language-",
            breaks: true,
          });
          loadTutorModeState();
          loadAllChats();
        });
        modalConfirmBtn.addEventListener("click", () => {
          if (typeof confirmCallback === "function") {
            confirmCallback();
          }
          hideConfirmationModal();
        });
        modalCancelBtn.addEventListener("click", hideConfirmationModal);
        modalOverlay.addEventListener("click", (e) => {
          if (e.target === modalOverlay) {
            hideConfirmationModal();
          }
        });
        $("#menu-toggle").addEventListener("click", toggleSidebar);
        $("#sidebar-overlay").addEventListener("click", toggleSidebar);
        $("#chat-form").addEventListener("submit", handleSendMessage);
        $("#chat-input").addEventListener("input", autoGrowTextarea);
        $("#chat-input").addEventListener("keydown", (e) => {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            handleSendMessage(e);
          }
        });
        $("#gallery-btn").addEventListener("click", () => {
          $("#file-input").removeAttribute("capture");
          $("#file-input").click();
        });
        $("#camera-btn").addEventListener("click", () => {
          $("#file-input").setAttribute("capture", "environment");
          $("#file-input").click();
        });
        $("#file-input").addEventListener("change", handleFileSelection);
        $("#new-chat-btn").addEventListener("click", startNewChat);
        $("#history-list").addEventListener("click", handleHistoryClick);
        $("#chat-messages").addEventListener("click", handleMessageAction);
        tutorModeBtn.addEventListener("click", toggleTutorMode);
        // --- NEW: Event listener for the notes button ---
        viewNotesBtn.addEventListener("click", showNotesView);
      }
      
      // --- NEW: Functions to switch between Chat and Notes views ---
      function showChatView() {
          markdownViewer.style.display = 'none';
          chatMessagesContainer.style.display = 'flex';
          chatFormContainer.style.display = 'block';
          viewNotesBtn.classList.remove('active');
          updateHistorySidebar(); // Re-highlight the active chat
      }
      
      function showNotesView() {
          chatMessagesContainer.style.display = 'none';
          chatFormContainer.style.display = 'none';
          markdownViewer.style.display = 'block';

          // Render the content
          renderContent(markdownViewer, conceptNotesMarkdown);

          // Update sidebar active state
          viewNotesBtn.classList.add('active');
          document.querySelectorAll('.history-item.active').forEach(item => {
              item.classList.remove('active');
          });

          if ($("#sidebar").classList.contains("open")) {
              toggleSidebar();
          }
      }

      const toggleSidebar = () => {
        $("#sidebar").classList.toggle("open");
        $("#sidebar-overlay").classList.toggle("open");
      };

      const autoGrowTextarea = () => {
        const input = $("#chat-input");
        input.style.height = "auto";
        input.style.height = input.scrollHeight + "px";
      };

      function toggleTutorMode() {
        showConfirmationModal(
          "Switching modes will start a new chat. Do you want to continue?",
          () => {
            isTutorMode = !isTutorMode;
            localStorage.setItem("ai-tutor-mode", isTutorMode);
            updateTutorButtonState();
            startNewChat();
          }
        );
      }

      function updateTutorButtonState() {
        if (isTutorMode) {
          tutorModeBtn.classList.add("active");
          tutorModeBtn.textContent = "Tutor Mode: ON";
        } else {
          tutorModeBtn.classList.remove("active");
          tutorModeBtn.textContent = "AI Tutor Mode";
        }
      }

      function loadTutorModeState() {
        isTutorMode = localStorage.getItem("ai-tutor-mode") === "true";
        updateTutorButtonState();
      }

      async function handleSendMessage(e, isEdit = false, editIndex = -1) {
        e.preventDefault();
        const userText = $("#chat-input").value.trim();
        if (userText === "" && uploadedFiles.length === 0 && !isEdit) return;
        if (!activeChatId) startNewChat(false);
        
        // --- MODIFIED: Ensure we are in chat view before sending ---
        showChatView();

        if (isEdit) {
          currentChatHistory = currentChatHistory.slice(0, editIndex + 1);
          currentChatHistory[editIndex].parts = [{ text: userText }];
          loadChat(activeChatId);
        } else {
          const userMessage = { role: "user", parts: [] };
          if (userText) userMessage.parts.push({ text: userText });
          uploadedFiles.forEach((file) => {
            userMessage.parts.push({
              inline_data: { mime_type: file.mimeType, data: file.base64 },
            });
          });
          currentChatHistory.push(userMessage);
          displayMessage(
            currentChatHistory.length - 1,
            "user",
            userText,
            uploadedFiles
          );
        }

        $("#chat-input").value = "";
        autoGrowTextarea();
        $("#file-previews").innerHTML = "";
        uploadedFiles = [];
        $("#file-input").value = "";

        const loadingMessage = displayMessage(
          -1,
          "loading",
          "Assistant is thinking..."
        );

        try {
          const modelResponse = await callBackendAPI();
          loadingMessage.remove();

          if (modelResponse && modelResponse.text) {
            const rawModelText = modelResponse.text;
            currentChatHistory.push({
              role: "model",
              parts: [{ text: rawModelText }],
            });
            displayMessage(
              currentChatHistory.length - 1,
              "model",
              rawModelText
            );
          } else {
            throw new Error("Invalid response from server.");
          }

          saveCurrentChat();
          updateHistorySidebar();
        } catch (error) {
          console.error("Backend API Error:", error);
          loadingMessage.remove();
          displayMessage(
            -1,
            "error",
            `Error: ${error.message || "Failed to get response from server."}`
          );
        }
      }

      async function callBackendAPI() {
        const requestBody = {
          history: currentChatHistory,
          is_tutor_mode: isTutorMode,
        };
        const response = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(requestBody),
        });
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.detail || "An unknown error occurred");
        }
        return response.json();
      }

      function displayMessage(index, role, text, files = []) {
        const messageEl = document.createElement("div");
        messageEl.className = `message ${role}`;
        messageEl.dataset.index = index;
        let fileHTML = "";
        if (files.length > 0) {
          fileHTML +=
            '<div style="display:flex; flex-wrap:wrap; gap:5px; margin-bottom: 8px;">';
          files.forEach((file) => {
            const src = `data:${file.mimeType};base64,${file.base64}`;
            if (file.mimeType.startsWith("image/")) {
              fileHTML += `<img src="${src}" style="max-width:80px; border-radius:4px;">`;
            } else if (file.mimeType.startsWith("video/")) {
              fileHTML += `<video controls style="max-width:120px; border-radius:4px;"><source src="${src}" type="${file.mimeType}"></video>`;
            }
          });
          fileHTML += "</div>";
        }
        messageEl.innerHTML = fileHTML;

        if (text) {
          const contentDiv = document.createElement("div");
          // --- IMPROVED: Use a shared class for consistent styling ---
          contentDiv.className = "message-content rendered-content-area";
          // --- IMPROVED: Use the centralized render function ---
          renderContent(contentDiv, text);
          messageEl.appendChild(contentDiv);
        }

        if (role === "user" || role === "model") {
          const actionsHTML = `<div class="message-actions">${
            role === "user"
              ? `<button class="action-btn edit-btn" title="Edit">✏️</button>`
              : ""
          }<button class="action-btn delete-btn" title="Delete">🗑️</button></div>`;
          messageEl.insertAdjacentHTML("beforeend", actionsHTML);
        }

        $("#chat-messages").appendChild(messageEl);
        $("#chat-messages").scrollTop = $("#chat-messages").scrollHeight;
        return messageEl;
      }

      function handleFileSelection(e) {
        const files = Array.from(e.target.files);
        if (uploadedFiles.length + files.length > 10) {
          showNotification("You can upload a maximum of 10 files.");
          return;
        }
        files.forEach((file) => {
          const reader = new FileReader();
          const fileId = Date.now() + Math.random();
          const previewEl = document.createElement("div");
          previewEl.className = "preview-item";
          previewEl.innerHTML = `<div class="loading-overlay"><div class="spinner"></div></div><button class="remove-file" data-id="${fileId}">&times;</button>`;
          $("#file-previews").appendChild(previewEl);
          previewEl
            .querySelector(".remove-file")
            .addEventListener("click", () => {
              uploadedFiles = uploadedFiles.filter((f) => f.id !== fileId);
              previewEl.remove();
            });
          reader.onload = (event) => {
            const base64String = event.target.result.split(",")[1];
            const fileData = {
              id: fileId,
              filename: file.name,
              mimeType: file.type,
              base64: base64String,
            };
            uploadedFiles.push(fileData);
            let mediaPreview;
            if (file.type.startsWith("image/"))
              mediaPreview = document.createElement("img");
            else {
              mediaPreview = document.createElement("video");
              mediaPreview.muted = true;
              mediaPreview.playsinline = true;
              mediaPreview.autoplay = true;
              mediaPreview.loop = true;
            }
            mediaPreview.src = event.target.result;
            previewEl.querySelector(".loading-overlay").remove();
            previewEl.prepend(mediaPreview);
          };
          reader.onerror = (error) => {
            console.error("File reading error:", error);
            previewEl.remove();
            showNotification(`Error reading file: ${file.name}`);
          };
          reader.readAsDataURL(file);
        });
      }

      function handleMessageAction(e) {
        const target = e.target;
        const messageEl = target.closest(".message");
        if (!messageEl) return;
        const index = parseInt(messageEl.dataset.index, 10);
        if (target.classList.contains("delete-btn")) {
          showConfirmationModal(
            "Are you sure you want to delete this message and all subsequent messages?",
            () => {
              currentChatHistory.splice(index);
              saveCurrentChat();
              loadChat(activeChatId);
            },
            true
          );
        } else if (target.classList.contains("edit-btn")) {
          const contentDiv = messageEl.querySelector(".message-content");
          const originalText =
            currentChatHistory[index].parts.find((p) => p.text)?.text || "";
          const editForm = document.createElement("form");
          editForm.style.display = "flex";
          editForm.style.flexDirection = "column";
          editForm.style.gap = "8px";
          editForm.innerHTML = `<textarea style="width:100%; min-height:80px; background:var(--bg-color); color:var(--text-color); border:1px solid var(--border-color); border-radius:4px; padding:8px;">${originalText}</textarea><div><button type="submit" style="background:var(--primary-color); color:var(--bg-color); border:none; padding:4px 8px; border-radius:4px; cursor:pointer;">Save & Submit</button><button type="button" class="cancel-edit" style="background:var(--surface-color); color:var(--text-color); border:none; padding:4px 8px; border-radius:4px; cursor:pointer;">Cancel</button></div>`;
          contentDiv.replaceWith(editForm);
          editForm.addEventListener("submit", (submitEvent) => {
            $("#chat-input").value = editForm.querySelector("textarea").value;
            handleSendMessage(submitEvent, true, index);
          });
          editForm
            .querySelector(".cancel-edit")
            .addEventListener("click", () => {
              loadChat(activeChatId);
            });
        }
      }

      const startNewChat = (render = true) => {
        // --- MODIFIED: Switch to chat view when starting a new chat ---
        showChatView();
        activeChatId = `chat_${Date.now()}`;
        currentChatHistory = [];
        allChats[activeChatId] = {
          id: activeChatId,
          history: [],
          timestamp: Date.now(),
        };
        const welcomeMessage = isTutorMode
          ? "AI Tutor Mode"
          : "Started a new chat. How can I assist you?";
        $(
          "#chat-messages"
        ).innerHTML = `<div class="message model rendered-content-area">${welcomeMessage}</div>`;
        saveAllChats();
        if (render) updateHistorySidebar();
        if ($("#sidebar").classList.contains("open")) toggleSidebar();
      };

      const saveCurrentChat = () => {
        if (!activeChatId) return;
        allChats[activeChatId].history = currentChatHistory;
        allChats[activeChatId].timestamp = Date.now();
        saveAllChats();
      };

      const saveAllChats = () =>
        localStorage.setItem("ai-all-chats", JSON.stringify(allChats));

      const loadAllChats = () => {
        const storedChats = localStorage.getItem("ai-all-chats");
        if (storedChats) allChats = JSON.parse(storedChats);
        updateHistorySidebar();
        const sortedChats = Object.values(allChats).sort(
          (a, b) => b.timestamp - a.timestamp
        );
        if (sortedChats.length > 0) {
          loadChat(sortedChats[0].id);
        } else {
          startNewChat();
        }
      };

      function updateHistorySidebar() {
        $("#history-list").innerHTML = "";
        // Don't highlight any chat if notes view is active
        const isNotesViewActive = viewNotesBtn.classList.contains('active');

        const sortedChats = Object.values(allChats).sort(
          (a, b) => b.timestamp - a.timestamp
        );
        sortedChats.forEach((chat) => {
          const historyItem = document.createElement("div");
          historyItem.className = "history-item";
          historyItem.dataset.id = chat.id;
          const firstUserMessage = chat.history.find(
            (msg) => msg.role === "user"
          );
          let previewText = "New Chat";
          if (firstUserMessage && firstUserMessage.parts[0]?.text) {
            previewText = firstUserMessage.parts[0].text;
          }
          historyItem.innerHTML = `<span class="history-title">${previewText}</span><button class="delete-chat-btn" data-id="${chat.id}" title="Delete Chat">🗑️</button>`;
          if (chat.id === activeChatId && !isNotesViewActive) {
            historyItem.classList.add("active");
          }
          $("#history-list").appendChild(historyItem);
        });
      }

      function handleHistoryClick(e) {
        const historyItem = e.target.closest(".history-item");
        if (!historyItem) return;
        if (e.target.classList.contains("delete-chat-btn")) {
          const chatId = e.target.dataset.id;
          showConfirmationModal(
            "Are you sure you want to delete this entire chat?",
            () => {
              delete allChats[chatId];
              saveAllChats();
              if (activeChatId === chatId) startNewChat();
              else updateHistorySidebar();
            },
            true
          );
        } else {
          const chatId = historyItem.dataset.id;
          loadChat(chatId);
          if ($("#sidebar").classList.contains("open")) toggleSidebar();
        }
      }

      function loadChat(chatId) {
        if (!allChats[chatId]) return;
        // --- MODIFIED: Switch to chat view when loading a chat ---
        showChatView();
        activeChatId = chatId;
        currentChatHistory = allChats[chatId].history;
        $("#chat-messages").innerHTML = "";
        if (currentChatHistory.length === 0) {
          const welcomeMessage = isTutorMode
            ? "AI Tutor Mode"
            : "This is an empty chat. Start the conversation!";
          $(
            "#chat-messages"
          ).innerHTML = `<div class="message model rendered-content-area">${welcomeMessage}</div>`;
        } else {
          currentChatHistory.forEach((message, index) => {
            const text = message.parts.find((p) => p.text)?.text || "";
            const filesData = message.parts
              .filter((p) => p.inline_data)
              .map((p) => ({
                mimeType: p.inline_data.mime_type,
                base64: p.inline_data.data,
              }));
            displayMessage(index, message.role, text, filesData);
          });
        }
        updateHistorySidebar();
      }

      // Initialize the application
      setupEventListeners();
      // --- END OF JAVASCRIPT ---
    </script>
  </body>
</html>